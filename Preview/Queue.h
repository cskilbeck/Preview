//////////////////////////////////////////////////////////////////////

#pragma once

//////////////////////////////////////////////////////////////////////

template<typename T, list_node<T> T::*NODE = null> class Queue
{
public:

	//////////////////////////////////////////////////////////////////////

	Queue()
	{
	}

	//////////////////////////////////////////////////////////////////////

	~Queue()
	{
	}

	//////////////////////////////////////////////////////////////////////

	Lock GetLock()
	{
		return Lock(critSec);
	}

	//////////////////////////////////////////////////////////////////////

	bool IsEmpty()
	{
		Lock _(critSec);
		return items.empty();
	}

	//////////////////////////////////////////////////////////////////////

	void Push(T *item)
	{
		Lock _(critSec);
		items.push_back(item);
	}

	//////////////////////////////////////////////////////////////////////

	size_t Length()
	{
		Lock _(critSec);
		return items.size();
	}

	//////////////////////////////////////////////////////////////////////

	T *Remove(T *p)
	{
		Lock _(critSec);
		return items.remove(p);
	}

	//////////////////////////////////////////////////////////////////////

	T *Pop()
	{
		Lock _(critSec);
		return items.pop_front();
	}

	//////////////////////////////////////////////////////////////////////

	template <typename U> T *Find(U const &f)
	{
		Lock _(critSec);
		for(auto p = items.head(); p != items.done(); p = items.next(p))
		{
			if(*p == f)
			{
				return p;
			}
		}
		return nullptr;
	}

	//////////////////////////////////////////////////////////////////////

protected:

	CriticalSection			critSec;
	linked_list<T, NODE>	items;

};
